let o=new MutationObserver(e=>{e.forEach(e=>{"childList"==e.type&&(e.removedNodes.forEach(e=>{collect(e).forEach(e=>{e[g.cleanup]&&e[g.cleanup]()})}),e.addedNodes.forEach(e=>{collect(e).forEach(e=>{e[g.append]&&e[g.append]()})}))})});function isImmut(e){return"string"==typeof e||"number"==typeof e}function isObj(e){if(e)return Object.getPrototypeOf(e)==Object.prototype}function destroy(e){for(let t in e){let n=e[t];n&&isObj(n)?destroy(n):n instanceof Map?n.forEach((e,t)=>{destroy(e),n.delete(t)}):n instanceof Set?(n.forEach(e=>{destroy(e)}),n.clear()):Array.isArray(n)&&n.forEach(e=>{destroy(e)}),delete e[t]}}function collect(e){let t=[];return!function e(n){(1==n.nodeType||3==n.nodeType)&&t.push(n),n.childNodes&&n.childNodes.forEach(t=>e(t))}(e),[...new Set(t)]}o.observe(document.body,{childList:!0,subtree:!0});let effectIndex=new Map,signalIndex=new Map,a=(e,...t)=>{let n;if("t"==e||"text"==e||"textnode"==e)return new Text(t[0]);n="f"==e||"frag"==e||"fragment"==e?document.createDocumentFragment():document.createElement(e);let l=[];return t.forEach(e=>{void 0!=e&&null!=e&&(isImmut(e)?l.push(document.createTextNode(e)):e instanceof Node?l.push(e):"function"==typeof e&&l.push(Render(e)))}),l.forEach(e=>{n.appendChild(e)}),t=null,l=null,n},A=new Proxy({},{get:(e,t)=>(...e)=>a(t.toLowerCase(),...e)});function rem(e,t){setTimeout(()=>{"function"==typeof e.destroy&&e.destroy(),e.remove(),e=null,t(),t=null},3e3)}function wrap(e,t,...n){return function(){e();let l=effectIndex.get(t);l&&l(...n)}}function b(e,...t){let n={},l;t.forEach((e,l)=>{isObj(e)&&(n={...e},delete t[l])}),l=A[e](...t);let r,s,i;if(r=new Map,s=new Set,i=new Set,n&&Object.keys(n).length)for(let u in n)if("use"==u)n[u].call(l);else if("sync"==u)s.add(n[u].bind(l));else if(u.startsWith("on")){let c=u.slice(2).toLowerCase();r.set(c,n[u].bind(l)),l.addEventListener(c,r.get(c)),c=null}else if("function"==typeof n[u])s.add(wrap($S(l,u,n[u]),global.RenderINDEX,{method:"property",key:u,element:l}));else if("style"==u){if("string"==typeof n[u])l[u]=n[u];else if("function"==typeof n[u])s.add(wrap($S(l,"style",n[u]),global.RenderINDEX,{method:"style",key:u,element:l}));else if(isObj(n[u])){let d=n[u];for(let f in d)"function"==typeof d[f]?s.add(wrap(()=>$CS(l,f,d[f]()),global.RenderINDEX,{method:"style",key:u,element:l})):l.style[f]=d[f];d=null}}else elementProperties.includes(u)?l[u]=n[u]:l.setAttribute(u,n[u]);let p={memo:global.memo,evented:Boolean(r.size),hooks:{},states:[],index:global.RenderINDEX,append(){p.evented||(r.forEach((e,t)=>{l.addEventListener(t,e)}),p.evented=!0),Boolean(i.size)||s.forEach(e=>{i.add(watch(e))})},clear(){p.evented&&(r.forEach((e,t)=>{l.removeEventListener(t,e)}),p.evented=!1),i.forEach(e=>{e&&e.remove()}),i.clear()},delete(){effectIndex.has(p.index)&&effectIndex.delete(p.index),signalIndex.has(p.index)&&signalIndex.delete(p.index),p.clear(),destroy(r),r=null,i.forEach(e=>{destroy(e)}),destroy(i),i=null,destroy(p.hooks),p.hooks=null,p.states.forEach(e=>{e&&e.kill&&e.kill()})}};function h(e,t){p.memo=Boolean(e),t||collect(l).forEach(e=>{e[g.memo](p.memo)})}function m(e){if(p.hooks&&p.hooks.onRemove&&p.hooks.onRemove.call(l),!p.memo||e){l[g.cleanup]=null;let t=collect(l),n=[];t.forEach(e=>{e[g.index]==p.index&&(e.remove(),n.push(e))}),t.forEach(t=>{t[g.cleanup]&&t[g.cleanup](e)}),rem(l,()=>l=null),t=null,destroy(n),n=null,p.delete(),destroy(p),delete l[g.memo],delete l[g.append],delete l[g.setHooks],delete l[g.index],p=null,h=null,y=null,E=null,m=null}else p.clear()}function y(){p.hooks&&p.hooks.onConnect&&p.hooks.onConnect.call(l),p.append()}function E(){let e=global.TempHooks,t=e[e.length-1],n=global.TempWatchers,l=n[n.length-1],r=global.states,i=r[r.length-1];t&&(p.hooks=e.pop(),p.hooks.onEffect&&effectIndex.set(p.index,p.hooks.onEffect),p.hooks.onSignal&&signalIndex.set(p.index,p.hooks.onSignal)),l&&n.pop().forEach(e=>{s.add(e)}),i&&(p.states=r.pop()),l=null,n=null,i=null,r=null,t=null,e=null}return l[g.index]=p.index,l[g.setHooks]=E,l[g.cleanup]=m,l[g.memo]=h,l[g.append]=y,l}HTMLElement.prototype.destroy=function(){this.outerHTML=null},HTMLElement.prototype.send=function(e){let t=this[g.index];if(void 0!=t&&signalIndex.has(t)){let n=signalIndex.get(t);n({from:this,signal:e}),n=null}t=null};let B=new Proxy({},{get:(e,t)=>(...e)=>b(t,...e)}),global={symbols:{memo:Symbol(),cleanup:Symbol(),append:Symbol(),setHooks:Symbol(),index:Symbol()},memo:!1,TempHooks:[],TempWatchers:[],states:[],state:"IDLE"},g=global.symbols;function Cleanup(e,t){let n=g.cleanup;e[n]&&e[n](t)}let RenderINDEX=0;function Render(e){global.state="RECORD",global.RenderINDEX=RenderINDEX++,global.states.push([]),global.TempHooks.push({}),global.TempWatchers.push([]);let t=e();if(t[g.setHooks])t[g.setHooks]();else{let n=global.states.pop(),l=global.TempHooks.pop(),r=global.TempWatchers.pop();(n.length||Object.keys(r).length||Object.keys(l).length)&&console.warn("DynaView Component-Scope Warning:\nThis component uses hooks and state management, but the first element is not a suitable HTML element. This may lead to memory leaks. Please ensure the first element is a valid one."),n.forEach(e=>e.kill()),l=null,r=null}return global.state="IDLE",t}function Memo(e){global.memo=!0;let t=Render(e);return global.memo=!1,t}function Remember(e,t){return collect(e).forEach(e=>{e[g.memo]&&e[g.memo](t??!0,!0)}),e}let elementProperties=["innerText","inner","textContent","className","nodeValue","style","innerHTML","outerHTML","dataset","contentEditable","draggable","checked","disabled","required","value","alt","role"];function $S(e,t,n){return elementProperties.includes(t)?()=>$CV(e,t,n()):()=>$CA(e,t,n())}function $CA(e,t,n){e.getAttribute(t)!==n&&e.setAttribute(t,n)}function $CS(e,t,n){e.style[t]!==n&&(e.style[t]=n)}function $CV(e,t,n){e[t]!==n&&(e[t]=n)}let StateContext=[];function createState(e){let t=new Set,n={initial:e,get:()=>(StateContext.length&&StateContext[StateContext.length-1].add(t),n.initial),set(e){let l=n.initial;return n.initial=e,l!==e&&t.forEach(e=>e({before:l,current:n.initial})),e}};function l(e){if(void 0!==e){let t="function"==typeof e?e(n.initial):e;return n.set(t)}if(e=null,n)return n.get()}return l.kill=function(){destroy({set:t,data:n}),t=null,n=null,l.kill=null,l=null},"RECORD"==global.state&&global.states[global.states.length-1].push(l),l}function createReducer(e,t){let n=createState(e),l;function r(e,...l){if(void 0===e)return n();{let r=t(n(),e,...l);if(void 0!=r)return n(r)}}return r.kill=()=>{l=null,n=null,r=null},l=n.kill,n.kill=()=>{l(),r.kill()},r}function createComputed(e){let t=createState(1),n=watch(()=>{t(e())}),l=t.kill;return t.kill=()=>{n.kill(),l(),l=null,t=null,n=null,e=null},t}function watch(e){StateContext.push(new Set);let t=e(),n=StateContext.pop();if(0==n.size)return t;t=null;let l={append(){n.forEach(t=>{t.add(e)})},remove(){n.forEach(t=>{t.delete(e)})},kill(){for(l.remove();n.length;)n.pop();n=null,destroy(l),e=null},trigger:e};return l.append(),l}function Watch(e){let t=global.TempWatchers,n=t[t.length-1];if("RECORD"!=global.state)return console.warn(`DynaView WATCH Warn:
This hook must be in a component scope! Use 'watch' instead of 'Watch' in non-component contexts.`),watch(e);n.push(e),t=null,n=null}let hooksGen=new Proxy({},{get:(e,t)=>function(e){let n=global.TempHooks,l=n[n.length-1];"RECORD"==global.state?(l[t]&&console.warn(`DynaView HookSet-${t.toUpperCase()} Warn:
${t} hook already set!`),l[t]=e):console.warn(`DynaView HookSet-${t.toUpperCase()} Warn:
This hook must be in a component scope!`),e=null,n=null,l=null}});function Switch(e){let t=createState(new Text);return watch(()=>{let n=t();t(Render(e)),n.replaceWith(Remember(t())),Cleanup(n),n=null}),t()}let{onConnect:e,onRemove:t,onEffect:n,onSignal:l}=hooksGen;function Mount(e,t,...n){let l,r,s;"string"==typeof e?l=document.querySelector(e):e instanceof HTMLElement?l=e:s+=" target must be a HTMLELEMENT -","function"==typeof t?r=Render(()=>t(...n)):t instanceof HTMLElement?r=t:s+=" output must be a HTMLELEMENT -",s?console.error("DynaView Mount Error:\n"+s):l.appendChild(r)}export{B as Elements,A,Mount,e as onConnect,t as onRemove,n as onEffect,l as onSignal,Watch,watch,createComputed,createReducer,createState,Remember,Memo,Render,Cleanup,Switch};
